<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>API Debug Page</h1>
    
    <div class="debug-section">
        <h3>Authentication Status</h3>
        <div id="auth-status"></div>
    </div>
    
    <div class="debug-section">
        <h3>Configuration</h3>
        <div id="config-info"></div>
    </div>
    
    <div class="debug-section">
        <h3>API Test Results</h3>
        <button onclick="testAPIs()">Test APIs</button>
        <div id="api-results"></div>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const token = sessionStorage.getItem('token');
            const authStatus = document.getElementById('auth-status');
            
            if (token) {
                authStatus.innerHTML = `
                    <div class="success">✓ Token found</div>
                    <div class="info">Token length: ${token.length}</div>
                    <div class="info">Token starts with: ${token.substring(0, 10)}...</div>
                `;
            } else {
                authStatus.innerHTML = '<div class="error">✗ No token found</div>';
            }
        }
        
        // Show configuration
        function showConfig() {
            const configInfo = document.getElementById('config-info');
            configInfo.innerHTML = `
                <div class="info">Backend URL: ${backend_url}</div>
                <div class="info">School API: ${backend_url}/api/v1/school</div>
                <div class="info">User API: ${backend_url}/api/v1/user</div>
            `;
        }
        
        // Test API endpoints
        async function testAPIs() {
            const token = sessionStorage.getItem('token');
            const resultsDiv = document.getElementById('api-results');
            
            if (!token) {
                resultsDiv.innerHTML = '<div class="error">No token available for testing</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div class="info">Testing APIs...</div>';
            
            const headers = {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            };
            
            try {
                // Test School API
                const schoolResponse = await fetch(`${backend_url}/api/v1/school`, { headers });
                const schoolData = await schoolResponse.json();
                
                // Test User API
                const userResponse = await fetch(`${backend_url}/api/v1/user`, { headers });
                const userData = await userResponse.json();
                
                resultsDiv.innerHTML = `
                    <div class="success">✓ API Tests Completed</div>
                    <h4>School API Response:</h4>
                    <div class="info">Status: ${schoolResponse.status} ${schoolResponse.statusText}</div>
                    <pre>${JSON.stringify(schoolData, null, 2)}</pre>
                    
                    <h4>User API Response:</h4>
                    <div class="info">Status: ${userResponse.status} ${userResponse.statusText}</div>
                    <pre>${JSON.stringify(userData, null, 2)}</pre>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">✗ API Test Failed</div>
                    <div class="error">Error: ${error.message}</div>
                `;
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            showConfig();
        });
    </script>
</body>
</html> 